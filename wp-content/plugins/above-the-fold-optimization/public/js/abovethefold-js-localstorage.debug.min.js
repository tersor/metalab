!function(a,b){"use strict";try{if(!("localStorage"in a&&null!==a.localStorage))return}catch(a){return}if("undefined"!=typeof a.Worker&&a.Worker){var c=[];try{var d="requestIdleCallback"in a&&null!==a.requestIdleCallback&&a.requestIdleCallback}catch(a){var d=!1}var e=function(b){"Promise"in a?new Promise(function(a,c){a(b())}):"undefined"!==a.setImmediate?a.setImmediate(b):setTimeout(b,0)},f={prefix:"abtf-",default_expire:86400,preloaded:{},now:function(){return+new Date/1e3},execWhenIdle:function(a,b){d?d(a,{timeout:b}):a()},saveScript:function(a,b,c){f.execWhenIdle(function(){var d={},e=f.now();if(d.date=e,d.expire=e+(c||f.default_expire),b instanceof Array){d.chunked=!0,d.chunks=b.length;for(var g=[],h=b.length,i=0;i<h;i++)g.push(b[i])}else{var g=!1;d.data=b}if(f.add(a,d),g)for(var h=g.length,i=0;i<h;i++)f.add("chunk:"+i+":"+a,g[i])},3e3)},getScript:function(a){if("undefined"!=typeof f.preloaded[a]&&f.preloaded[a]!==!1)return f.preloaded[a];f.preloaded[a]=!1;var b=f.get(a);if(!b)return!1;if("undefined"!=typeof b.expire&&b.expire-f.now()<0)return!1;if("undefined"!=typeof b.chunked&&b.chunked===!0){for(var d,e=[],h=0;h<b.chunks;h++){if(d=f.get("chunk:"+h+":"+a),d===!1)return!1;e.push(d)}b.data=e.join("")}return f.preloaded[a]=g(b.data,"application/javascript"),c.push(f.preloaded[a]),f.preloaded[a]},preloadScript:function(a){"undefined"==typeof f.preloaded[a]&&f.execWhenIdle(function(){"undefined"==typeof f.preloaded[a]&&(f.preloaded[a]=f.getScript(a))},100)},add:function(a,b,c){if("undefined"!=typeof c&&parseInt(c)>10)return void console.error("Abtf.js() ➤ localStorage quota reached","retry limit reached, abort saving...",a);"object"==typeof b&&(b=JSON.stringify(b));try{return localStorage.setItem(f.prefix+a,b),!0}catch(i){if(i.name.toUpperCase().indexOf("QUOTA")>=0){var d,e,g,h=[];for(d in localStorage)0===d.indexOf(f.prefix)&&d.indexOf("chunk:")===-1&&(g=d.split(f.prefix)[1],e=f.get(g),e&&h.push([g,e]));return h.length?(h.sort(function(a,b){return a[1].date-b[1].date}),console.error("Abtf.js() ➤ localStorage quota reached","removed",h[0][0],"for key",a),f.remove(h[0][0]),void f.execWhenIdle(function(){"undefined"==typeof c&&(c=0),f.add(a,b,++c)},1e3)):void console.error("Abtf.js() ➤ localStorage quota reached","no files to remove")}return void console.error("Abtf.js() ➤ localStorage error",i.name,i)}},remove:function(a){var b=f.get(a);if(b){if(b.chunked)for(var c=parseInt(b.chunks),d=0;d<c;d++)localStorage.removeItem(f.prefix+"chunk:"+d+":"+a);localStorage.removeItem(f.prefix+a)}},get:function(a){var b=localStorage.getItem(f.prefix+a);try{return a.indexOf("chunk:")!==-1?b||!1:JSON.parse(b||"false")}catch(a){return!1}},clear:function(a){var b,c,d,e=this.now(),g=[];for(b in localStorage)if(c=b.split(f.prefix)[1]){if(c.indexOf("chunk:")!==-1)continue;if(d=f.get(c),!d)continue;(!a||d.expire<=e)&&(f.remove(c),g.push(c))}g.length>0&&console.warn("Abtf.js() ➤ localStorage cleared",g.length,"expired scripts")}},g=function(b,c){var d;try{d=new Blob([b],{type:c})}catch(e){a.BlobBuilder=a.BlobBuilder||a.WebKitBlobBuilder||a.MozBlobBuilder,d=new BlobBuilder,d.append(b),d=d.getBlob(c)}return URL.createObjectURL(d)},h=function(){self.FETCH=self.fetch||!1,self.DEFAULT_TIMEOUT=5e3,self.MAX_CHUNK_SIZE=1e5,self.CHUNK_DATA=function(a,b){for(var c,d=Math.ceil(a.length/b),e=new Array(d),f=0;f<d;f++)c=f*b,e[f]=a.substring(c,c+b);return e},self.LOAD_RESOURCE=function(a){var b=!1,c=!1,d=function(d,e){if(!b){if(b=!0,c&&(clearTimeout(c),c=!1),!d&&e){var f=e.length;f>MAX_CHUNK_SIZE&&(e=CHUNK_DATA(e,MAX_CHUNK_SIZE))}RESOURCE_LOAD_COMPLETED(a,d,e)}};if(FETCH){var e={method:"GET",mode:"cors",cache:"default"},f=function(a){b||("object"==typeof a&&a.status&&(a=[a.status,a.statusText]),d(a))};FETCH(a.url,e).then(function(a){b||(a.ok?a.text().then(function(a){d(!1,a)}):d([a.status,a.statusText]))},f).catch(f);var g=a.timeout||DEFAULT_TIMEOUT;isNaN(g)&&(g=DEFAULT_TIMEOUT),c=setTimeout(function(){b||d("timeout")},g)}else{var h=new XMLHttpRequest;h.open("GET",a.url,!0),h.responseType="text",h.onreadystatechange=function(){b||4===h.readyState&&(200!==h.status?d(h.statusText):d(!1,h.responseText))},h.onerror=function(){b||d(h.statusText)};var g=a.timeout||DEFAULT_TIMEOUT;isNaN(g)&&(g=DEFAULT_TIMEOUT),c=setTimeout(function(){if(!b){try{h.abort()}catch(a){}d("timeout")}},g),h.send(null)}},self.RESOURCE_LOAD_COMPLETED=function(a,b,c){b?(b instanceof Array||"object"!=typeof b||(b=b.toString()),self.postMessage([2,a.i,b])):self.postMessage([1,a.i,c])},self.onmessage=function(a){var b=a.data;if(b instanceof Array)for(var c=b.length,d=0;d<c;d++)"object"==typeof b[d]&&"undefined"!=typeof b[d].url&&"undefined"!=typeof b[d].i&&LOAD_RESOURCE(b[d]);else{if("object"!=typeof b||"undefined"==typeof b.url||"undefined"==typeof b.i)throw new Error("Web Worker Script Loader: Invalid resource object");LOAD_RESOURCE(b)}}}.toString().replace(/^function\s*\(\s*\)\s*\{/,"").replace(/\}$/,""),i={workerUri:g(h,"application/javascript"),worker:!1,scriptIndex:0,scriptQueue:[],start:function(){this.worker=new Worker(this.workerUri),this.worker.addEventListener("message",this.handleMessage),this.worker.addEventListener("error",this.handleError)},stop:function(){this.worker&&(this.worker.removeEventListener("message",this.handleMessage),this.worker.removeEventListener("error",this.handleError),this.worker.terminate(),this.worker=!1,console.warn("Abtf.js() ➤ web worker terminated"))},handleMessage:function(a){var b=a.data,c=b[1];return"undefined"==typeof i.scriptQueue[c]?void console.error("Abtf.js() ➤ web worker script loader invalid response",b):1===parseInt(b[0])?void i.scriptQueue[c].onData(b[2]):2===parseInt(b[0])?b[2]instanceof Array&&parseInt(b[2][0])>200&&parseInt(b[2][0])<600?void console.error("Abtf.js() ➤ web worker ➤ "+b[2][0]+" "+b[2][1],i.scriptQueue[c].url):void console.error("Abtf.js() ➤ web worker script loader error",b[2]):void 0},handleError:function(a){console.error("Abtf.js() ➤ web worker script loader error",a)},loadScript:function(b,c){this.worker||this.start(),b=a.Abtf.proxifyScript(b);var d=parseInt(this.scriptIndex);this.scriptIndex++,this.scriptQueue[d]={url:b,onData:c},this.worker.postMessage({url:b,i:d})}};if(i.start(),a.addEventListener("beforeunload",function(a){if(i.stop(),c.length>0)for(var b=c.length,d=0;d<b;d++)try{URL.revokeObjectURL(c[d])}catch(a){console.error("Abtf.js() ➤ failed to revoke script url",c[d],a)}}),d)d(function(){f.clear(!0)},{timeout:3e3});else{var j,k=function(){j&&clearTimeout(j),j=setTimeout(function(){f.clear(!0)},2e3)};k(),b.onScriptLoad(k)}a.Abtf.loadCachedScript=function(a,c,d){e(function(){var e=f.getScript(a);return e?(d(e),void b.loadScript(e,c)):(d(!1),void b.loadScript(a,function(){c(),i.loadScript(a,function(c){return c?(c instanceof Array?console.info("Abtf.js() ➤ web worker ➤ localStorage saved chunked","("+c.length+" chunks)",b.localUrl(a)):console.info("Abtf.js() ➤ web worker ➤ localStorage saved","("+c.length+")",b.localUrl(a)),void f.saveScript(a,c)):void console.error("Abtf.js() ➤ web worker script loader no data",b.localUrl(a))})}))})},a.Abtf.preloadCachedScript=function(a){e(function(){f.preloadScript(a)})},a.Abtf.cachedScriptUrl=function(a){var c=f.getScript(a);return c?c:(i.loadScript(a,function(c){return c?(c instanceof Array?console.info("Abtf.js() ➤ web worker ➤ localStorage saved chunked","("+c.length+" chunks)",b.localUrl(a)):console.info("Abtf.js() ➤ web worker ➤ localStorage saved","("+c.length+")",b.localUrl(a)),void f.saveScript(a,c)):void console.error("Abtf.js() ➤ web worker script loader no data",b.localUrl(a))}),a)}}}(window,window.Abtf);